# Testwigr Architecture Diagrams

## System Architecture Diagram

```plaintext
┌─────────────────────────────────────────────────────────────────────────┐
│                            Client Applications                          │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            NGINX Reverse Proxy                          │
│                  (SSL Termination, Security Headers)                    │
└───────────────────────────────────┬─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          Spring Boot Application                        │
├─────────────────┬─────────────────┬────────────────┬────────────────────┤
│  API Versioning │  Rate Limiting  │  JWT Security  │  Error Handling    │
├─────────────────┴─────────────────┴────────────────┴────────────────────┤
│                                                                         │
│ ┌─────────────────────────────┐  ┌─────────────────────────────────────┐│
│ │       Controllers           │  │              Services               ││
│ │                             │  │                                     ││
│ │  ┌─────────────────────┐    │  │  ┌─────────────────────────────┐    ││
│ │  │    AuthController   │    │  │  │       UserService           │    ││
│ │  └─────────────────────┘    │  │  └─────────────────────────────┘    ││
│ │  ┌─────────────────────┐    │  │  ┌─────────────────────────────┐    ││
│ │  │    UserController   │    │  │  │       PostService           │    ││
│ │  └─────────────────────┘    │  │  └─────────────────────────────┘    ││
│ │  ┌─────────────────────┐    │  │  ┌─────────────────────────────┐    ││
│ │  │    PostController   │◄───┼──┼─►│       FeedService           │    ││
│ │  └─────────────────────┘    │  │  └─────────────────────────────┘    ││
│ │  ┌─────────────────────┐    │  │                                     ││
│ │  │  CommentController  │    │  └──────────────────┬──────────────────┘│
│ │  └─────────────────────┘    │                     │                   │
│ │  ┌─────────────────────┐    │                     ▼                   │
│ │  │    LikeController   │    │  ┌─────────────────────────────────────┐│
│ │  └─────────────────────┘    │  │           Repositories              ││
│ │  ┌─────────────────────┐    │  │                                     ││
│ │  │    FeedController   │    │  │  ┌─────────────────────────────┐    ││
│ │  └─────────────────────┘    │  │  │      UserRepository         │    ││
│ │  ┌─────────────────────┐    │  │  └─────────────────────────────┘    ││
│ │  │   HealthController  │    │  │  ┌─────────────────────────────┐    ││
│ │  └─────────────────────┘    │  │  │      PostRepository         │    ││
│ │                             │  │  └─────────────────────────────┘    ││
│ └─────────────────────────────┘  └─────────────────────────────────────┘│
│                                                                         │
│             ┌───────────────────────────────────────────┐               │
│             │              Domain Models                │               │
│             │                                           │               │
│             │  ┌──────────────┐ ┌──────────────┐        │               │
│             │  │     User     │ │     Post     │        │               │
│             │  └──────────────┘ └──────────────┘        │               │
│             │                   ┌──────────────┐        │               │
│             │                   │   Comment    │        │               │
│             │                   └──────────────┘        │               │
│             └───────────────────────────────────────────┘               │
└─────────────────────────────────┬─────────────────────────────────────┬─┘
                                  │                                     │
                                  ▼                                     ▼
┌─────────────────────────────────────────┐    ┌──────────────────────────┐
│                MongoDB                  │    │   Monitoring Stack       │
│                                         │    │  (Prometheus, Grafana)   │
└─────────────────────────────────────────┘    └──────────────────────────┘
```

## Deployment Architecture Diagram

```plaintext
┌─────────────────────────────────────────────────────────────────────┐
│                        Docker Host / Cloud Provider                 │
│                                                                     │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                    Docker Network                            │   │
│  │                                                              │   │
│  │  ┌───────────────┐    ┌────────────────┐    ┌──────────────┐ │   │
│  │  │    NGINX      │    │  Spring Boot   │    │   MongoDB    │ │   │
│  │  │ Reverse Proxy │◄──►│  Application   │◄──►│   Database   │ │   │
│  │  └───────┬───────┘    └────────────────┘    └──────────────┘ │   │
│  │          │                                                   │   │
│  │          │            ┌────────────────┐    ┌──────────────┐ │   │
│  │          │            │   Prometheus   │◄──►│   Grafana    │ │   │
│  │          │            │  (Monitoring)  │    │ (Dashboard)  │ │   │
│  │          │            └────────────────┘    └──────────────┘ │   │
│  │          │                                                   │   │
│  └──────────┼───────────────────────────────────────────────────┘   │
│             │                                                       │
└─────────────┼───────────────────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────┐
│     Client Requests     │
└─────────────────────────┘
```

## Data Model Diagram

```plaintext
┌───────────────────────────────────┐       ┌───────────────────────────────────┐
│              User                 │       │               Post                │
├───────────────────────────────────┤       ├───────────────────────────────────┤
│ id: String                        │       │ id: String                        │
│ username: String (unique)         │       │ content: String                   │
│ email: String (unique)            │       │ userId: String (ref → User.id)    │
│ password: String (encrypted)      │       │ username: String                  │
│ displayName: String               │       │ likes: Set<String> (ref → User.id)│
│ bio: String                       │       │ comments: List<Comment>           │
│ following: Set<String> (ref → id) │◄──────┤ createdAt: LocalDateTime          │
│ followers: Set<String> (ref → id) │       │ updatedAt: LocalDateTime          │
│ createdAt: LocalDateTime          │       │                                   │
│ updatedAt: LocalDateTime          │       │                                   │
│ active: boolean                   │       │                                   │
└───────────────────────────────────┘       └───────────────────────┬───────────┘
                                                                    │
                                                                    │
                                             ┌────────────────────────────────────┐
                                             │            Comment                 │
                                             │  (Embedded in Post)                │
                                             ├────────────────────────────────────┤
                                             │ id: String                         │
                                             │ content: String                    │
                                             │ userId: String (ref → User.id)     │
                                             │ username: String                   │
                                             │ createdAt: LocalDateTime           │
                                             └────────────────────────────────────┘
```

## Authentication Flow Diagram

```plaintext
┌─────────┐                     ┌─────────────┐                 ┌────────────┐
│ Client  │                     │ Spring Boot │                 │  MongoDB   │
│         │                     │ Application │                 │  Database  │
└────┬────┘                     └──────┬──────┘                 └─────┬──────┘
     │                                 │                              │
     │  1. Registration Request        │                              │
     │ ────────────────────────────►   │                              │
     │                                 │                              │
     │                                 │  2. Check Username/Email     │
     │                                 │ ────────────────────────────►│
     │                                 │                              │
     │                                 │  3. Return Availability      │
     │                                 │ ◄────────────────────────────│
     │                                 │                              │
     │                                 │  4. Hash Password            │
     │                                 │ ─────┐                       │
     │                                 │      │                       │
     │                                 │ ◄────┘                       │
     │                                 │                              │
     │                                 │  5. Store User               │
     │                                 │ ────────────────────────────►│
     │                                 │                              │
     │                                 │  6. User Saved               │
     │                                 │ ◄────────────────────────────│
     │                                 │                              │
     │  7. Registration Success        │                              │
     │ ◄────────────────────────────   │                              │
     │                                 │                              │
     │  8. Login Request               │                              │
     │ ────────────────────────────►   │                              │
     │                                 │                              │
     │                                 │  9. Fetch User               │
     │                                 │ ────────────────────────────►│
     │                                 │                              │
     │                                 │  10. Return User             │
     │                                 │ ◄────────────────────────────│
     │                                 │                              │
     │                                 │  11. Verify Password         │
     │                                 │ ─────┐                       │
     │                                 │      │                       │
     │                                 │ ◄────┘                       │
     │                                 │                              │
     │                                 │  12. Generate JWT Token      │
     │                                 │ ─────┐                       │
     │                                 │      │                       │
     │                                 │ ◄────┘                       │
     │                                 │                              │
     │  13. Return JWT Token           │                              │
     │ ◄────────────────────────────   │                              │
     │                                 │                              │
     │  14. API Request with JWT       │                              │
     │ ────────────────────────────►   │                              │
     │                                 │                              │
     │                                 │  15. Validate JWT            │
     │                                 │ ─────┐                       │
     │                                 │      │                       │
     │                                 │ ◄────┘                       │
     │                                 │                              │
     │                                 │  16. Fulfill Request         │
     │                                 │ ─────┐                       │
     │                                 │      │                       │
     │                                 │ ◄────┘                       │
     │                                 │                              │
     │  17. API Response               │                              │
     │ ◄────────────────────────────   │                              │
     │                                 │                              │
```

## Environment Setup Diagram

```plaintext
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Development Environment                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌───────────────┐     ┌─────────────────┐              │
│  │  Spring     │     │   MongoDB     │     │  Mongo Express  │              │
│  │  Boot App   │◄───►│   Database    │◄───►│  (Admin UI)     │              │
│  │  (Dev Mode) │     │               │     │                 │              │
│  └─────────────┘     └───────────────┘     └─────────────────┘              │
│                                                                             │
│  • Hot-reloading enabled                                                    │
│  • Detailed logging                                                         │
│  • All endpoints exposed                                                    │
│  • Swagger UI available                                                     │
│  • In-memory or containerized database                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                             Testing Environment                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌───────────────┐     ┌─────────────────┐              │
│  │  Test       │     │   MongoDB     │     │  Mongo Express  │              │
│  │  Runner     │◄───►│   Test DB     │◄───►│  (Admin UI)     │              │
│  │             │     │               │     │                 │              │
│  └─────────────┘     └───────────────┘     └─────────────────┘              │
│                                                                             │
│  • Isolated test database                                                   │
│  • Simplified security                                                      │
│  • Test-specific configuration                                              │
│  • High rate limits for tests                                               │
│  • Test data factories                                                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                            Production Environment                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌───────────────┐     ┌─────────────┐     ┌──────────┐ │
│  │   NGINX     │     │  Spring Boot  │     │  MongoDB    │     │ Grafana  │ │
│  │   Proxy     │◄───►│  Application  │◄───►│  Database   │     │ Dashboard│ │
│  │   (SSL)     │     │               │     │             │     │          │ │
│  └─────────────┘     └───────────────┘     └─────────────┘     └────┬─────┘ │
│                                                                     │       │
│                                                                     ▼       │
│                                                              ┌─────────────┐│
│                                                              │ Prometheus  ││
│                                                              │ Monitoring  ││
│                                                              └─────────────┘│
│  • SSL termination                                                          │
│  • Security hardening                                                       │
│  • MongoDB authentication                                                   │
│  • Limited exposure of endpoints                                            │
│  • Structured JSON logging                                                  │
│  • Monitoring & alerting                                                    │
│  • Environment variable configuration                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Test Pyramid Diagram

```plaintext
             ▲
             │                       ┌───────────────────┐
             │                       │   End-to-End      │
             │                       │     Tests         │
             │                       └───────────────────┘
             │                  ┌───────────────────────────┐
             │                  │      Integration          │
             │                  │        Tests              │
Number of    │                  └───────────────────────────┘
  Tests      │              ┌───────────────────────────────────┐
             │              │         Controller Tests          │
             │              └───────────────────────────────────┘
             │          ┌─────────────────────────────────────────────┐
             │          │          Service Tests                      │
             │          └─────────────────────────────────────────────┘
             │      ┌─────────────────────────────────────────────────────┐
             │      │                 Repository Tests                    │
             │      └─────────────────────────────────────────────────────┘
             │  ┌─────────────────────────────────────────────────────────────┐
Execution    │  │                        Unit Tests                           │
 Speed       └──┴─────────────────────────────────────────────────────────────┘
                                        Test Coverage
